{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SINgle CelL AnalysIs Resource (SINCLAIR)","text":"<p>The SINCLAIR pipeline was developed by the CCR Collaborative Bioinformatics Resource as an open-source, reproducible solution for multiple single cell next-generation modalities. It has been developed and tested solely on NIH HPC Biowulf.</p> <p> <sup>Overview of Single Cell RNASeq Gene Expression Pipeline</sup></p>"},{"location":"user-guide/contributions/","title":"Contributions","text":"<p>The following members contributed to the development of the scRNA pipeline:</p> <ul> <li>Abdalla Abdelmaksoud</li> <li>Nathan Wong</li> <li>Samantha Sevilla</li> <li>Vishal Koparde</li> </ul> <p>AA, NW, SS contributed to the generating the source code and all members contributed to the main concepts and analysis.</p>"},{"location":"user-guide/getting-started/","title":"Overview","text":"<p>The scRNA github repository is stored locally, and will be used for project deployment. Multiple projects can be deployed from this one point simultaneously, without concern.</p>"},{"location":"user-guide/getting-started/#1-getting-started","title":"1. Getting Started","text":""},{"location":"user-guide/getting-started/#11-introduction","title":"1.1 Introduction","text":"<p>The scRNA Pipelie beings at various stages, depending on the users needs. The pipeline can begin with GEX FASTQ files, performing cell counting, with 10X Genomic's CellRanger. Then, normalization and pre-processing occurs, using custom R scripts with packages like Seurat. Alternatively the user can begin with .h5 files, beginning the pipeline post-preprocessing. [TODO: add as we go!]</p>"},{"location":"user-guide/getting-started/#12-setup-dependencies","title":"1.2 Setup Dependencies","text":"<p>scRNA has several dependencies listed below. These dependencies can be installed by a sysadmin. All dependencies will be automatically loaded if running from Biowulf.</p> <ul> <li>nextflow: \"nextflow/23.04.1\"</li> <li>cellranger \"cellranger:7.1.0\"</li> <li>R: \"R/4.3\"</li> </ul> <p>Docker containers to run the pipeline are currently in development.</p>"},{"location":"user-guide/getting-started/#13-login-to-the-cluster","title":"1.3 Login to the cluster","text":"<p>scRNA has been exclusively tested on Biowulf HPC. Login to the cluster's head node and move into the pipeline location. <pre><code># ssh into cluster's head node\nssh -Y $USER@biowulf.nih.gov\n</code></pre></p>"},{"location":"user-guide/getting-started/#14-load-an-interactive-session","title":"1.4 Load an interactive session","text":"<p>An interactive session should be started before performing any of the pipeline sub-commands, even if the pipeline is to be executed on the cluster.</p> <pre><code># Grab an interactive node\nsinteractive --time=12:00:00 --mem=8gb  --cpus-per-task=4 --pty bash\n</code></pre>"},{"location":"user-guide/output/","title":"4. Expected Outputs","text":"<p>The following directories are created under the WORKDIR directory:</p> <ul> <li>batch_correct: contains the various RDS files for batch correction methods (CCA, HARMONY, ScVI, RPCA, LIGER) and batch correction report (HTML)</li> <li>cellranger_counts: contains the h5 files, if <code>cellranger count</code> is deployed</li> <li>pipeline_info: contains execution_reports, execution_trace and pipeline_dag files from NextFlow</li> <li>samplesheets: contains the manifests used to identify samples, contrasts, and sample:contrast groupings</li> <li>seurat: contains multiple seurat-generated directories:<ul> <li>preprocess: contains sample level data; both RDS and PDF files from pre-processing</li> <li>merge: contrast grouped, sample level data; both RDS and PDf files of pre-processed, merging</li> </ul> </li> </ul> <pre><code>\u2500 batch_correct\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_batch_correction_cca.rds\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_batch_correction_harmony.rds\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_batch_correction_integration.html\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_batch_correction_liger.rds\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_batch_correction_rpca.rds\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_batch_correction_scvi.rds\n\u251c\u2500\u2500 cellranger_counts\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sample1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 outs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 filtered_feature_bc_matrix.h5\n\u251c\u2500\u2500 pipeline_info\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 execution_report_2023-09-20_12-45-47.html\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 execution_timeline_2023-09-20_12-45-47.html\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 execution_trace_2023-09-20_12-45-47.txt\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 pipeline_dag_2023-09-20_12-45-47.svg\n\u251c\u2500\u2500 samplesheets\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 project_contrast_samplesheet.csv\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 project_gex_samplesheet.csv\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 project_groups_samplesheet.csv\n\u2514\u2500\u2500 seurat\n    \u251c\u2500\u2500 merge\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 group1-group2_seurat_merged.pdf\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 group1-group2_seurat_merged.rds\n    \u2514\u2500\u2500 preprocess\n        \u251c\u2500\u2500 sample1_seurat_preprocess.pdf\n        \u251c\u2500\u2500 sample1_seurat_preprocess.rds\n</code></pre>"},{"location":"user-guide/preparing-files/","title":"2. Preparing Files","text":"<p>The pipeline is controlled through editing configuration and manifest files. Defaults are found in the /PIPELINEDIR/conf and /PIPELINEDIR/ directories</p> <p> <sup>Overview of Single Cell RNASeq Gene Expression Process</sup></p>"},{"location":"user-guide/preparing-files/#21-configs","title":"2.1 Configs","text":"<p>The configuration files control parameters and software of the pipeline. These files are listed below:</p> <ul> <li>nextflow.config</li> <li>conf/base.config</li> <li>conf/modules.config</li> <li>conf/process_params.config</li> <li>conf/Rpack.config</li> </ul>"},{"location":"user-guide/preparing-files/#211-nextflow-config","title":"2.1.1 NextFlow Config","text":"<p>The configuration file dictates the global information to be used during the pipeline. </p>"},{"location":"user-guide/preparing-files/#212-base-config","title":"2.1.2 Base Config","text":"<p>The configuration file dictates submission to Biowulf HPC. There are two different ways to control these parameters - first, to control the default settings, and second, to create or edit individual rules. These parameters should be edited with caution, after significant testing.</p>"},{"location":"user-guide/preparing-files/#213-modules-config","title":"2.1.3 Modules Config","text":"<p>The configuration file dictates process-specific processing parameters, including:</p> <ul> <li>the version of each software or program that is being used in the pipeline</li> <li>output location and file names</li> <li>additional arguments to be passed to the process</li> </ul>"},{"location":"user-guide/preparing-files/#214-r-package-config","title":"2.1.4 R Package Config","text":"<p>The configuration file dictates which R libraries, and which versions, are loaded into the accompanying R script</p>"},{"location":"user-guide/preparing-files/#213-process-parameters","title":"2.1.3 Process Parameters","text":"<p>The configuration file dictates process-specific user parameters, which varies for each process. Users can choose varied resolution values or QC methods, for example.</p>"},{"location":"user-guide/preparing-files/#22-preparing-manifests","title":"2.2 Preparing Manifests","text":"<p>There are two manifests, which are required. These files describe information on the samples and desired contrasts. These files are:</p> <ul> <li>/assets/input_manifest.csv</li> <li>/assets/contrast_manifest.csv</li> </ul>"},{"location":"user-guide/preparing-files/#221-input-manifest","title":"2.2.1 Input Manifest","text":"<p>This manifest will include information to sample level information. It includes the following column headers:</p> <ul> <li>masterID: This is the biological sample ID; duplicates are allowed in this column</li> <li>uniqueID: This is a unique sample level ID; duplicates are not allowed in this column</li> <li>groupID: This is the groupID which should match to the <code>contrast_manifest</code>; duplicates are allowed in this column</li> <li>dataType: This is the datatype for the input sample; options are 'gex' 'atac' 'vdj'</li> <li>input_dir: This is the input directory for the data files of the sample type (IE \"/path/to/sample1/fastq\")</li> </ul> <p>An example sampleManifest file is shown below:</p> masterID uniqueID groupID dataType input_dir WB_Lysis_1 sample1 group1 gex /data/CCBR_Pipeliner/Pipelines/TechDev_scRNASeq_Dev2023/test_dir/ WB_Lysis_1 sample2 group1 gex /data/CCBR_Pipeliner/Pipelines/TechDev_scRNASeq_Dev2023/test_dir/ WB_Lysis_2 sample3 group2 gex /data/CCBR_Pipeliner/Pipelines/TechDev_scRNASeq_Dev2023/test_dir/ WB_Lysis_2 sample4 group2 gex /data/CCBR_Pipeliner/Pipelines/TechDev_scRNASeq_Dev2023/test_dir/ WB_Lysis_3 sample5 group3 gex,/data/CCBR_Pipeliner/Pipelines/TechDev_scRNASeq_Dev2023/test_dir/ WB_Lysis_Granulocytes_3p_Introns_8kCells_fastqs/sample5 WB_Lysis_1 sample6 group1 atac /data/CCBR_Pipeliner/Pipelines/TechDev_scRNASeq_Dev2023/test_dir/"},{"location":"user-guide/preparing-files/#222-contrast-manifest","title":"2.2.2 Contrast Manifest","text":"<p>This manifest will include sample information to performed differential comparisons. A few requirements:</p> <ul> <li>groups listed must match groups within the <code>input_manifest</code> groupID column</li> <li>headers should be included for the max number of contrasts. In the example below, the second contrast contains 3 groups, and so the header includes contrast1-contrast3</li> <li>multiple groups can be added by increasing the header and adding additional contrasts, as needed</li> </ul> <p>An example contrast file:</p> contrast1 contrast2 contrast3 group1 group2 group1 group2 group3"},{"location":"user-guide/run/","title":"3. Running the Pipeline","text":""},{"location":"user-guide/run/#31-pipeline-overview","title":"3.1 Pipeline Overview","text":"<p>The Nextflow workflow can be run as follows: <pre><code>nextflow run main.nf \\\n    -entry $datatype \\\n    -profile biowulf \\\n    --input assets/input_manifest.csv \\\n    --contrast assets/contrast_manifest.csv \\\n    --outdir /data/sevillas2/scRNA_test \\\n    --species $species \\\n    $args\n</code></pre></p>"},{"location":"user-guide/run/#32-commands-explained","title":"3.2 Commands explained","text":"<p>The following explains each of the command options:</p> <ul> <li>entry: accepts the datatype to be used; IE gex</li> <li>profile: how to run the processes; IE biowulf singularity, docker</li> <li>input: input_manifest.csv location</li> <li>contrast: contrast_manifest.csv location</li> <li>outdir: complete path to the output dir</li> <li>species: species to be used</li> <li>run_cellranger: whether or not to run cellranger on dataset; IE Y, N</li> <li>args: any additional arguments; IE --stub-run</li> </ul>"},{"location":"user-guide/run/#33-typical-workflow","title":"3.3 Typical Workflow","text":"<p>A typical command workflow, running the pipeline for the first time locally, is as follows: <pre><code>nextflow run main.nf \\\n    -entry gex \\\n    -profile biowulf \\\n    --input assets/input_manifest.csv \\\n    --contrast assets/contrast_manifest.csv \\\n    --outdir /path/to/scRNA_test \\\n    --species hg19\n</code></pre></p> <p>A typical command workflow, running the pipeline for a repeated time locally, running cellranger, is as follows: <pre><code>nextflow run main.nf -resume \\\n    -entry gex \\\n    -profile biowulf \\\n    --run_cellranger Y \\\n    --input assets/input_manifest.csv \\\n    --contrast assets/contrast_manifest.csv \\\n    --outdir /path/to/scRNA_test \\\n    --run_cellranger Y \\\n    --species hg19\n</code></pre></p> <p>A typical command workflow, running the pipeline in a <code>dryrun mode</code>, without running cellranger, is as follows: <pre><code>nextflow run main.nf \\\n    -entry gex \\\n    -profile biowulf \\\n    --run_cellranger Y \\\n    --input assets/input_manifest.csv \\\n    --contrast assets/contrast_manifest.csv \\\n    --outdir /path/to/scRNA_test \\\n    --species hg19 \\\n    --run_cellranger N \\\n    --stub-run\n</code></pre></p> <p>Alternatively a script was created to run the pipeline, which takes the following flags: - species: hg19 - datatype: GEX - outDir: /path/to/output/dir - resume: Y or N - run_cellranger: Y or N - stubrun: Y or N</p> <p>Examples: <pre><code># run GEX on test data, for the first time\nsh run_scRNA.sh hg19 GEX N /path/to/output/dir\n\n# first pass, with and without cellranger\nsh run_scRNA.sh hg19 GEX /path/to/output/dir N Y N\nsh run_scRNA.sh hg19 GEX /path/to/output/dir N Y N\n\n# resume, with and without cellranger\nsh run_scRNA.sh hg19 GEX /path/to/output/dir Y Y N\nsh run_scRNA.sh hg19 GEX /path/to/output/dir Y N N\n\n# first pass, with cellranger, with and without a dryrun\nsh run_scRNA.sh hg19 GEX /path/to/output/dir N Y Y\nsh run_scRNA.sh hg19 GEX /path/to/output/dir N Y N\n</code></pre></p>"},{"location":"user-guide/test-info/","title":"5. Running Test Data","text":"<p>Isolation protocol: CG000392 RevA: Isolation of Leukocytes, Bone Marrow and Peripheral Blood Mononuclear Cells for Single Cell RNA Sequencing - Whole Blood Lysis for Granuloctyes track. Whole transcriptome/Gene Expression libraries were generated as described in the Chromium Next GEM Single Cell 3' Reagent Kits v3.1 (Dual Index) User Guide (CG000204 Rev D). TUTORIAL: https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/tutorials/neutrophils SOURCE: https://www.10xgenomics.com/resources/datasets/whole-blood-rbc-lysis-for-pbmcs-neutrophils-granulocytes-3-3-1-standard</p>"},{"location":"user-guide/test-info/#wb_1","title":"WB_1","text":"<ul> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L001_I1_001.fastq.gz</li> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L001_I2_001.fastq.gz</li> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L001_R1_001.fastq.gz</li> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L001_R2_001.fastq.gz</li> </ul>"},{"location":"user-guide/test-info/#wb_2","title":"WB_2","text":"<ul> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L002_I1_001.fastq.gz</li> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L002_I2_001.fastq.gz</li> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L002_R1_001.fastq.gz</li> <li>WB_Lysis_Granulocytes_3p_Introns_8kCells_S1_L002_R2_001.fastq.gz</li> </ul>"},{"location":"user-guide/test-info/#wb_3-and-wb_4-are-copies","title":"WB_3 and WB_4 are copies","text":"<ul> <li>WB_1 \u2192 WB_3</li> <li>WB_2 \u2192 WB_4</li> </ul>"},{"location":"user-guide/test-info/#samples-were-then-subsampled-with-a-set-seed","title":"samples were then subsampled with a set seed","text":"<ul> <li>WB_1 \u2192 sample1,sample2 \u2192 s100</li> <li>WB_2 \u2192 sample3,sample4 \u2192 s101</li> <li>WB_3 \u2192 sample5,sample6 \u2192 s102</li> <li>WB_4 \u2192 sample7,sample8 \u2192 s103</li> </ul>"},{"location":"user-guide/test-info/#grouping-tests-should-be","title":"grouping tests should be","text":"<ul> <li>group1,group2</li> <li>group3,group4</li> <li>group1+group3,group2+group4</li> </ul>"},{"location":"user-guide/troubleshooting/","title":"Troubleshooting","text":"<p>Recommended steps to troubleshoot the pipeline.</p>"},{"location":"user-guide/troubleshooting/#11-email","title":"1.1 Email","text":"<p>Check your email for an email regarding pipeline failure. You will receive an email from slurm@biowulf.nih.gov with the subject: Slurm Job_id=[#] Name=CARLISLE Failed, Run time [time], FAILED, ExitCode 1</p>"},{"location":"user-guide/troubleshooting/#12-review-the-log-files","title":"1.2 Review the log files","text":"<p>Review the logs in two ways:</p> <ol> <li>Review the master slurm file: This file will be found in the <code>/path/to/results/dir/</code> and titled <code>slurm-[jobid].out</code>. Reviewing this file will tell you what rule errored, and for any local SLURM jobs, provide error details</li> <li>Review the individual rule log files: After reviewing the master slurm-file, review the specific rules that failed within the <code>/path/to/results/dir/logs/</code>. Each rule will include a <code>.err</code> and <code>.out</code> file, with the following formatting: <code>{rulename}.{masterjobID}.{individualruleID}.{wildcards from the rule}.{out or err}</code></li> </ol>"},{"location":"user-guide/troubleshooting/#13-restart-the-run","title":"1.3 Restart the run","text":"<p>After addressing the issue, unlock the output directory, perform another dry-run and check the status of the pipeline, then resubmit to the cluster. <pre><code>nextflow run main.nf \\\n    -entry $datatype \\\n    -profile biowulf \\\n    --input assets/input_manifest.csv \\\n    --contrast assets/contrast_manifest.csv \\\n    --outdir /data/sevillas2/scRNA_test \\\n    --species $species \\\n    $args\n</code></pre></p>"},{"location":"user-guide/troubleshooting/#14-contact-information","title":"1.4 Contact information","text":"<p>If after troubleshooting, the error cannot be resolved, or if a bug is found, please create an issue and send and email to Samantha Chill.</p>"}]}